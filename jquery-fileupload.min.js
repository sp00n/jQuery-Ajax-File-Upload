(function(e,t,n,r){function o(t,n){this.element=t;this.$form=e(t);this.$uploaders=e("input[type=file]",this.element);this.files={};this.settings=e.extend({},s,n);this._defaults=s;this._name=i;this.init()}var i="fileUpload",s={uploadData:{},submitData:{},uploadOptions:{},submitOptions:{},before:function(){},beforeSubmit:function(){return true},success:function(){},error:function(){},complete:function(){}};o.prototype={init:function(){this.$uploaders.on("change",{context:this},this.processFiles);this.$form.on("submit",{context:this},this.uploadFiles)},processFiles:function(t){var n=t.data.context;n.files[e(t.target).attr("name")]=t.target.files},uploadFiles:function(t){t.stopPropagation();t.preventDefault();var n=t.data.context;if(!n.settings.before())return;var r=new FormData;r.append("file_upload_incoming","1");e.each(n.files,function(t,n){e.each(n,function(e,t){r.append(e,t)})});e.each(n.settings.uploadData,function(e,t){r.append(e,t)});e.ajax(e.extend({},{url:n.$form.attr("action"),type:"POST",data:r,cache:false,dataType:"json",processData:false,contentType:false,success:function(e,r,i){n.processSubmit(t,e)},error:function(e,t,r){n.settings.error(e,t,r)}},n.settings.uploadOptions))},processSubmit:function(t,n){var r=t.data.context;if(!r.settings.beforeSubmit(n))return;var i=r.$form.serializeArray();e.each(n,function(e,t){i.push({name:e,value:t})});e.each(r.settings.submitData,function(e,t){i.push({name:e,value:t})});e.ajax(e.extend({},{url:r.$form.attr("action"),type:"POST",data:i,cache:false,dataType:"json",success:function(e,t,n){r.settings.success(e,t,n)},error:function(e,t,n){r.settings.error(e,t,n)},complete:function(e,t){r.settings.complete(e,t)}},r.settings.submitOptions))}};e.fn[i]=function(t){return this.each(function(){if(!e.data(this,"plugin_"+i)){e.data(this,"plugin_"+i,new o(this,t))}})}})(jQuery,window,document)
